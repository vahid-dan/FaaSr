# work in progress - we want a JSON schema to validate a payload
# there's an R library for this - https://cran.r-project.org/web/packages/jsonvalidate/vignettes/jsonvalidate.html
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://flare-forecast.org/FaaSr.schema.json",
  "title": "FaaSr invocation payload",
  "description": "Schema for an invocation of FaaSr",
  "type": "object",
  "properties": {
    "FunctionInvoke": {
      "description": "The name of the R function to be invoked by this action",
      "type": "string"
    },
    "InvocationID": {
      "description": "The unique ID used throughout all action invocations for this workflow",
      "type": "string"
    },
    "LoggingServer": {
      "description": "The name of the logging server to use - must match an S3 server defined under DataStores",
      "type": "string"
    },
    "FunctionList": {
      "description": "A list of one or more functions that describes the workflow",
      "type": "object",
      "patternProperties": {
        "":{
            "type":"object",
            "properties":{
                  "FaaSServer":{"type":"string"},
                  "Actionname":{"type":"string"},
                  "Arguments":{"type":"object"},
                  "InvokeNext":{"type":"array"}
                  },
            "required":["FaaSServer", "Actionname"],
            "additionalProperties": false
        }
      }
      # need to figure out how to represent that at least one entry is required
    },
    "ComputeServers": {
      "description": "A list of one or more FaaS compute servers used in the workflow",
      "type": "object",
      "patternProperties": {
        "":{
            "type":"object",
            "properties":{
                  "FaaSType":{"enum":["Openwhisk","GithubAction","Lambda"]},
                  "Region":{"type":"string"},
                  "Endpoint":{"type":"string"},
                  "Namespace":{"type":"string"},
                  "API.key":{"type":"string"}
                  },
            "required":["FaaSType", "Region", "Endpoint", "Namespace", "API.key"],
            "additionalProperties": false
        }
      }
      # need to figure out how to represent that at least one entry is required
    },
    "DataStores": {
      "description": "A list of one or more S3 data servers used in the workflow",
      "type": "object",
      "patternProperties": {
        "":{
            "type":"object",
            "properties":{
                  "Endpoint":{"type":"string"},
                  "Protocol":{"type":"string"},
                  "AccessKey":{"type":"string"},
                  "SecretKey":{"type":"string"},
                  "Bucket":{"type":"string"},
                  "Region":{"type":"string"},
                  # Can be turned into boolean
                  "Writable":{"type":"string"}
                  },
            "required":["Endpoint", "Protocol", "AccessKey", "SecretKey", "Bucket", "Region"],
            "additionalProperties": false
        }
      }
      # need to figure out how to represent that at least one entry is required
    }
  },
  "required": [ "FunctionInvoke", "LoggingServer", "FunctionList", "ComputeServers", "DataStores" ]
}
